<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reel Text AI - Hochzeitsdienstleister Instagram Generator</title>
    <meta name="description" content="Erstelle emotionale Instagram Reel Overlay-Texte für Hochzeitsdienstleister. Kreativ, buchungsstark und herzberührend.">
    <meta name="keywords" content="Hochzeitsdienstleister, Instagram Reels, Hochzeitsfotograf, Hochzeitsplaner, Social Media, KI Generator">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🎬%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #667eea 50%, #f093fb 75%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
            color: #ffffff;
            overflow-x: hidden;
            font-size: 14px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(26, 26, 46, 0.85);
            backdrop-filter: blur(15px);
            padding: 32px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            /* height: 90vh; */ /* code Lederhos - 90vh entfernt da sonst das Tool in der Learningsuite nicht volle höhe hat. */
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 32px;
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .logo::before {
            content: "🎬";
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            margin-bottom: 40px;
            line-height: 1.5;
        }

        .input-group {
            margin-bottom: 28px;
            position: relative;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
            font-size: 15px;
            letter-spacing: 0.3px;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 16px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 15px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            color: rgba(255, 255, 255, 0.95);
            resize: none;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #f5576c;
            box-shadow: 0 0 0 3px rgba(245, 87, 108, 0.3);
            background: rgba(0, 0, 0, 0.5);
            transform: translateY(-1px);
        }

        .input-group input::placeholder,
        .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-group textarea {
            min-height: 100px;
            line-height: 1.6;
        }

        /* Style Selection Buttons */
        .style-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }

        .style-option {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .style-option::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .style-option:hover::before {
            animation: shimmer 0.6s ease-in-out;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
                opacity: 0;
            }
        }

        .style-option:hover {
            transform: translateY(-3px) scale(1.02);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 24px rgba(245, 87, 108, 0.3);
        }

        .style-option.selected {
            background: linear-gradient(135deg, #f5576c, #f093fb);
            border-color: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 32px rgba(245, 87, 108, 0.4);
        }

        .style-option.selected:hover {
            transform: translateY(-3px) scale(1.05);
        }

        .style-icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .style-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 6px;
            color: rgba(255, 255, 255, 0.95);
        }

        .style-description {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
        }

        .style-option.selected .style-description {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Optional Field Styling */
        .optional-field {
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 24px;
            background: rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .optional-badge {
            position: absolute;
            top: -8px;
            left: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Generate Button */
        .generate-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #f5576c, #f093fb);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 8px 24px rgba(245, 87, 108, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 40px;
            position: relative;
            overflow: hidden;
        }

        .generate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .generate-btn:hover::before {
            left: 100%;
        }

        .generate-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 32px rgba(245, 87, 108, 0.5);
        }

        .generate-btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-icon {
            font-size: 20px;
        }

        /* Info Notice */
        .info-notice {
            background: rgba(103, 126, 234, 0.15);
            border: 1px solid rgba(103, 126, 234, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 32px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .info-notice strong {
            color: #667eea;
        }

        .info-notice .icon {
            margin-right: 8px;
            font-size: 16px;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .step.active {
            color: #f5576c;
        }

        .step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #f5576c, #f093fb);
            color: white;
        }

        .step-arrow {
            color: rgba(255, 255, 255, 0.3);
            font-size: 12px;
        }

        /* Results Section */
        .results-section {
            margin-top: 40px;
            display: none;
        }

        .results-section.visible {
            display: block;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-title {
            font-size: 20px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 24px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .reel-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .reel-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .reel-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #f5576c, #f093fb);
        }

        .reel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px rgba(245, 87, 108, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-number {
            background: linear-gradient(135deg, #f5576c, #f093fb);
            color: white;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 12px;
        }

        .reel-hook {
            font-size: 18px;
            font-weight: 700;
            color: #f5576c;
            margin-bottom: 12px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .reel-main {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
            margin-bottom: 12px;
            text-align: center;
            white-space: pre-line;
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .copy-btn {
            background: rgba(103, 126, 234, 0.2);
            color: #667eea;
            border: 1px solid rgba(103, 126, 234, 0.3);
        }

        .copy-btn:hover {
            background: rgba(103, 126, 234, 0.3);
            transform: translateY(-1px);
        }

        .copy-btn.copied {
            background: rgba(40, 167, 69, 0.3);
            color: #28a745;
            border-color: rgba(40, 167, 69, 0.5);
        }

        .copy-btn.error {
            background: rgba(220, 53, 69, 0.3) !important;
            color: #dc3545 !important;
            border-color: rgba(220, 53, 69, 0.5) !important;
        }

        .favorite-btn {
            background: rgba(245, 87, 108, 0.2);
            color: #f5576c;
            border: 1px solid rgba(245, 87, 108, 0.3);
        }

        .favorite-btn:hover {
            background: rgba(245, 87, 108, 0.3);
            transform: translateY(-1px);
        }

        .favorite-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .regenerate-section {
            text-align: center;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .regenerate-btn {
            background: rgba(108, 117, 125, 0.2);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .regenerate-btn:hover {
            background: rgba(108, 117, 125, 0.4);
            color: white;
            transform: translateY(-2px);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.7);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top-color: #f5576c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 24px;
                margin: 10px;
                max-height: 95vh;
            }
            
            body {
                font-size: 13px;
                padding: 10px;
            }
            
            .logo {
                font-size: 20px;
                margin-bottom: 24px;
            }

            .subtitle {
                font-size: 14px;
                margin-bottom: 32px;
            }

            .style-selector {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .generate-btn {
                padding: 18px;
                font-size: 16px;
            }

            .progress-steps {
                flex-direction: column;
                gap: 12px;
            }

            .step-arrow {
                transform: rotate(90deg);
            }

            .reel-cards {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(245, 87, 108, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(245, 87, 108, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(245, 87, 108, 0);
            }
        }
    </style>
</head>
<body>
    <div class="container fade-in">
        <div class="logo">
            Reel Text AI für Hochzeitsdienstleister
        </div>

        <div class="subtitle">
            Erstelle emotionale Instagram Reel Overlay-Texte für dein Hochzeitsbusiness<br>
            Verwandle deine Hochzeitsvideos in buchungsstarke Content-Magneten
        </div>

        <div class="progress-steps">
            <div class="step active">
                <div class="step-number">1</div>
                <span>Hochzeitsvideo beschreiben</span>
            </div>
            <div class="step-arrow">→</div>
            <div class="step">
                <div class="step-number">2</div>
                <span>Hochzeitsservice definieren</span>
            </div>
            <div class="step-arrow">→</div>
            <div class="step">
                <div class="step-number">3</div>
                <span>Stil wählen</span>
            </div>
            <div class="step-arrow">→</div>
            <div class="step">
                <div class="step-number">4</div>
                <span>Texte generieren</span>
            </div>
        </div>



        <div class="input-group">
            <label>
                Was sehe ich in deinem Hochzeitsvideo?
            </label>
            <textarea 
                id="backgroundVideo" 
                placeholder="z.B. Eine Braut, die emotional ihren Brautstrauß wirft, strahlende Gesichter der Gäste, ein Paar beim ersten Tanz in goldenem Licht, Detailaufnahmen von Ringen und Dekoration..."
                rows="3"
            ></textarea>
        </div>

        <div class="input-group">
            <label>
                Welchen Hochzeitsservice bietest du an?
            </label>
            <textarea 
                id="service" 
                placeholder="z.B. Hochzeitsfotografie für emotionale Momente, Hochzeitsplanung für Märchenhochzeiten, Brautstyling für den perfekten Look, Hochzeitslocation-Vermietung..."
                rows="2"
            ></textarea>
        </div>

        <div class="input-group">
            <label>
                Stil des Textes
            </label>
            <div class="style-selector" id="styleSelector">
                <div class="style-option" data-style="inspiration">
                    <span class="style-icon">✨</span>
                    <div class="style-title">Inspiration</div>
                    <div class="style-description">Tipps, Empfehlungen und Inspiration. Perfekt für hilfreiche Inhalte und wertvolle Hochzeits-Inspiration.</div>
                </div>
                <div class="style-option" data-style="funny">
                    <span class="style-icon">😄</span>
                    <div class="style-title">Humorvoll</div>
                    <div class="style-description">Locker, charmant und unterhaltsam. Ideal für lockere Paare und entspannte Hochzeitsstimmung.</div>
                </div>
                <div class="style-option" data-style="realtalk">
                    <span class="style-icon">💯</span>
                    <div class="style-title">Realtalk</div>
                    <div class="style-description">Direkt, ehrlich und ohne Filter. Zeigt die Realität hinter den Kulissen oder teile eine meinungsstarke Aussage!</div>
                </div>
            </div>
        </div>

        <div class="input-group">
            <div class="optional-field">
                <div class="optional-badge">Optional, aber empfohlen</div>
                <label>
                    Hast du schon eine Idee für dein Reel?
                </label>
                <textarea 
                    id="reelIdea" 
                    placeholder="z.B. Ich möchte zeigen, wie wichtig der perfekte Moment für Hochzeitsfotos ist und dass jedes Detail zählt, um die Liebe eines Paares für die Ewigkeit festzuhalten..."
                    rows="3"
                ></textarea>
            </div>
        </div>

        <button class="generate-btn pulse" id="generateBtn">
            <span class="btn-icon"></span>
            Hochzeits-Reel-Texte generieren
        </button>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <div class="results-title">
                <span></span>
                Deine generierten Reel-Texte
                <span></span>
            </div>
            <div class="reel-cards" id="reelCards">
                <!-- Generated cards will be inserted here -->
            </div>
            <div class="regenerate-section">
                <button class="regenerate-btn" id="regenerateBtn">
                    <span></span>
                    Neue Varianten generieren
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentFormData = null;
        let generatedTexts = [];

        // DOM Elements
        const styleOptions = document.querySelectorAll('.style-option');
        const generateBtn = document.getElementById('generateBtn');
        const regenerateBtn = document.getElementById('regenerateBtn');
        const resultsSection = document.getElementById('resultsSection');
        const reelCards = document.getElementById('reelCards');

        // <!-- ========================================= -->
        // <!-- CODE LEDERHOS COPY BLOCK                  -->
        // <!-- ========================================= -->
        
                // IDs aus Iframe-URL
                const TOOL_ID = Number(new URLSearchParams(location.search).get('tool_id')||'0');
                const USER_ID = new URLSearchParams(location.search).get('user_id') || '';
                
                // Preflight
                function preflight(kind='tool'){ 
                  return new Promise(resolve=>{
                    const onMsg = ev => {
                      const d = ev.data||{};
                      if(d.mkz==='allow_generate'){ window.removeEventListener('message',onMsg); resolve(true); }
                      if(d.mkz==='deny_generate'){ window.removeEventListener('message',onMsg); showToast(d.reason==='limit' ? `Credit-Limit erreicht. Noch ${d.days_left} Tage bis Reset.` : 'Aktion abgebrochen.'); resolve(false); }
                    };
                    window.addEventListener('message', onMsg);
                    window.parent.postMessage({ mkz:'request_generate', tool_id:TOOL_ID, kind }, '*');
                    setTimeout(()=>{ window.removeEventListener('message', onMsg); resolve(false); }, 5000);
                  });
                }
                
                // Consume melden
                let lastConsumeAt=0;
                function notifyParentConsume(kind='tool', payload={}){
                  if(!TOOL_ID) return;
                  const now=Date.now();
                  if(now-lastConsumeAt<1200) return; // Entprellen
                  lastConsumeAt=now;
                  window.parent.postMessage({ mkz:'consume', tool_id:TOOL_ID, kind, payload }, '*');
                }
                function sendConsume(action, input = {}, output = {}, kind = 'tool') {
                  notifyParentConsume(kind, { action, input, output });
                }
                
                // Buttons global sperren/freigeben
                function setActionState(disabled){
                  const selectors = ['#generateOutlineBtn', '#optimizeTitleBtn', '.action-btn.generate', '.action-btn.magic', '.chat-popup-send-btn'];
                  selectors.forEach(sel => document.querySelectorAll(sel).forEach(btn => btn.disabled = !!disabled));
                }
                
                // Toast im Tool
                function showToast(msg){
                  let box = document.getElementById('mkz-toast');
                  if(!box){ box=document.createElement('div'); box.id='mkz-toast'; box.style.cssText='position:fixed;right:16px;bottom:16px;z-index:99999;display:flex;flex-direction:column;gap:8px'; document.body.appendChild(box);}
                  const n=document.createElement('div');
                  n.style.cssText='padding:10px 14px;border-radius:10px;font:14px system-ui;color:#fff;background:#b91c1c;box-shadow:0 4px 16px rgba(0,0,0,.25)';
                  n.textContent=msg; box.appendChild(n); setTimeout(()=>n.remove(),4200);
                }
        
                // Höhe an Parent melden, damit das Iframe sich anpasst
                function reportHeight() {
                  const h = Math.max(
                    document.documentElement.scrollHeight,
                    document.body.scrollHeight,
                    document.documentElement.offsetHeight,
                    document.body.offsetHeight
                  );
                  const toolId = Number(new URLSearchParams(location.search).get('tool_id') || '0');
                  window.parent?.postMessage({ mkz:'content_height', tool_id: toolId, height: h }, '*');
                }
                
                // Auf Anforderung antworten
                window.addEventListener('message', ev => {
                  const d = ev.data || {};
                  if (d.mkz === 'request_height') reportHeight();
                });
                
                // Bei Layout-Änderungen automatisch updaten
                const ro = new ResizeObserver(() => { reportHeight(); });
                ro.observe(document.documentElement);
                ro.observe(document.body);
                
                // Fallback alle 2s einmal messen (für dynamische Inhalte)
                setInterval(reportHeight, 2000);
                
                // Optional: Scroll innerhalb des Tools unterbinden, damit nur außen gescrollt wird
                document.documentElement.style.overflow = 'hidden';
                document.body.style.overflow = 'hidden';

                function makeIdemKey(prefix='cl'){
                  return (crypto?.randomUUID
                    ? `${prefix}_${crypto.randomUUID()}`
                    : `${prefix}_${Date.now()}_${Math.random().toString(36).slice(2)}`);
                }
        
                
        // <!-- ========================================= -->
        // <!-- CODE LEDERHOS COPY BLOCK END              -->
        // <!-- ========================================= -->

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Handle style selection
            styleOptions.forEach(option => {
                option.addEventListener('click', function() {
                    styleOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    updateProgressSteps();
                });
            });

            // Auto-resize textareas
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 200) + 'px';
                    updateProgressSteps();
                });
            });

            // Generate button
            generateBtn.addEventListener('click', generateReelTexts);
            regenerateBtn.addEventListener('click', regenerateTexts);

            // Initial progress update
            updateProgressSteps();

            // Entrance animations
            setTimeout(() => {
                document.querySelectorAll('.input-group').forEach((group, index) => {
                    setTimeout(() => {
                        group.style.opacity = '0';
                        group.style.transform = 'translateY(20px)';
                        group.style.transition = 'all 0.5s ease';
                        setTimeout(() => {
                            group.style.opacity = '1';
                            group.style.transform = 'translateY(0)';
                        }, 50);
                    }, index * 100);
                });
            }, 500);
        }

        function updateProgressSteps() {
            const steps = document.querySelectorAll('.step');
            const backgroundVideo = document.getElementById('backgroundVideo').value.trim();
            const service = document.getElementById('service').value.trim();
            const selectedStyle = document.querySelector('.style-option.selected');

            // Reset all steps
            steps.forEach(step => step.classList.remove('active'));

            // Activate steps based on completion
            steps[0].classList.add('active');

            if (backgroundVideo) {
                steps[1].classList.add('active');
            }

            if (backgroundVideo && service) {
                steps[2].classList.add('active');
            }

            if (backgroundVideo && service && selectedStyle) {
                steps[3].classList.add('active');
            }
        }

        async function generateReelTexts() {
            const formData = getFormData();
            
            if (!validateForm(formData)) {
                return;
            }

            if(!(await preflight('tool'))) return;  // Code Lederhos COPY ROW
            const idem = makeIdemKey('gen-copy');   // Code Lederhos COPY ROW

            console.log('Sending request with data:', formData);
            currentFormData = formData;
            setLoadingState(true);

            try {
                const response = await fetch('/api/generate-reel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                console.log('Response status:', response.status);
                
                const data = await response.json();
                console.log('Response data:', data);

                if (!response.ok) {
                    throw new Error(data.error || `HTTP ${response.status}: ${data.details || 'Unbekannter Fehler'}`);
                }

                generatedTexts = data.reelTexts;
                displayResults(data.reelTexts);

                sendConsume('generate_reel', { idem }, { reel_preview: JSON.stringify((data && data.reelTexts || []).slice(0,2)).slice(0,2000) }, 'tool'); // Code Lederhos COPY ROW

            } catch (error) {
                console.error('Generation Error Details:', error);
                
                // Benutzerfreundliche Fehlermeldung
                let userMessage = error.message;
                
                if (error.message.includes('Failed to fetch')) {
                    userMessage = 'Verbindungsfehler. Bitte überprüfe deine Internetverbindung und versuche es erneut.';
                } else if (error.message.includes('NetworkError')) {
                    userMessage = 'Netzwerkfehler. Bitte versuche es in wenigen Sekunden erneut.';
                }
                
                alert(`❌ Fehler bei der Generierung:\n\n${userMessage}\n\nBitte versuche es erneut oder kontaktiere den Support.`);
            } finally {
                setLoadingState(false);
            }
        }

        async function regenerateTexts() {
            if (!currentFormData) {
                alert('Bitte generiere zuerst Texte!');
                return;
            }

            regenerateBtn.disabled = true;
            regenerateBtn.innerHTML = '<span></span> Generiere neue Varianten...';

            try {
                const response = await fetch('/api/generate-reel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(currentFormData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Fehler bei der Regenerierung');
                }

                generatedTexts = data.reelTexts;
                displayResults(data.reelTexts);

            } catch (error) {
                console.error('Regeneration Error:', error);
                alert(`Fehler bei der Regenerierung: ${error.message}`);
            } finally {
                regenerateBtn.disabled = false;
                regenerateBtn.innerHTML = '<span></span> Neue Varianten generieren';
            }
        }

        function getFormData() {
            return {
                backgroundVideo: document.getElementById('backgroundVideo').value.trim(),
                service: document.getElementById('service').value.trim(),
                style: document.querySelector('.style-option.selected')?.dataset.style || '',
                optionalIdea: document.getElementById('reelIdea').value.trim()
            };
        }

        function validateForm(formData) {
            if (!formData.backgroundVideo) {
                alert('Bitte beschreibe dein Hochzeitsvideo!');
                document.getElementById('backgroundVideo').focus();
                return false;
            }

            if (!formData.service) {
                alert('Bitte beschreibe deinen Hochzeitsservice!');
                document.getElementById('service').focus();
                return false;
            }

            if (!formData.style) {
                alert('Bitte wähle einen Text-Stil aus!');
                return false;
            }

            return true;
        }

        function setLoadingState(isLoading) {
            if (isLoading) {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<span class="btn-icon"></span>Generiere Hochzeits-Reel-Texte...';
                
                // Show loading in results section
                resultsSection.classList.add('visible');
                reelCards.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>Erstelle emotionale Reel-Texte für dein Hochzeitsbusiness...</div>
                    </div>
                `;
            } else {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span class="btn-icon"></span>Hochzeits-Reel-Texte generieren';
            }
        }

        function displayResults(reelTexts) {
            resultsSection.classList.add('visible');
            
            const cardsHTML = (reelTexts || []).map((text, index) => `
                <div class="reel-card" style="animation-delay: ${index * 0.1}s">
                    <div class="card-header">
                        <div class="card-number">Variante ${text.id}</div>
                    </div>
                    <div class="reel-hook">${text.hook}</div>
                    <div class="reel-main">${text.mainText}</div>
                    <div class="card-actions">
                        <button class="action-btn copy-btn" onclick="copyToClipboard(${text.id})">
                            <span></span> Kopieren
                        </button>
                        <button class="action-btn favorite-btn" onclick="regenerateVariant(${text.id})">
                            <span></span> Neu generieren
                        </button>
                    </div>
                </div>
            `).join('');

            reelCards.innerHTML = cardsHTML;

            // Scroll to results
            setTimeout(() => {
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }, 300);
        }

        async function copyToClipboard(textId) {
            const text = generatedTexts.find(t => t.id === textId);
            if (!text) {
                console.error('Text not found for ID:', textId);
                return;
            }

            const fullText = `${text.hook}\n\n${text.mainText}`;
            const button = event.target.closest('.copy-btn');
            const originalHTML = button.innerHTML;
            
            console.log('Attempting to copy:', fullText);

            try {
                // Moderne Clipboard API (bevorzugt)
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(fullText);
                    console.log('✅ Copied with Clipboard API');
                } else {
                    // Fallback für ältere Browser oder unsichere Kontexte
                    console.log('Using fallback copy method');
                    
                    // Erstelle temporäres Textarea Element
                    const textArea = document.createElement('textarea');
                    textArea.value = fullText;
                    textArea.style.position = 'fixed';
                    textArea.style.top = '-1000px';
                    textArea.style.left = '-1000px';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    
                    // Fokussiere und selektiere
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        // Versuche mit execCommand zu kopieren
                        const successful = document.execCommand('copy');
                        if (!successful) {
                            throw new Error('execCommand copy failed');
                        }
                        console.log('✅ Copied with execCommand');
                    } finally {
                        document.body.removeChild(textArea);
                    }
                }
                
                // Erfolgs-Feedback
                button.classList.add('copied');
                button.innerHTML = '<span></span> Kopiert!';
                
                // Button nach 2 Sekunden zurücksetzen
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = originalHTML;
                }, 2000);
                
            } catch (error) {
                console.error('❌ Copy failed:', error);
                
                // Fehlschlag-Feedback
                button.classList.add('error');
                button.innerHTML = '<span></span> Fehler';
                
                // Fallback: Text in Modal anzeigen
                showCopyModal(fullText);
                
                // Button nach 2 Sekunden zurücksetzen
                setTimeout(() => {
                    button.classList.remove('error');
                    button.innerHTML = originalHTML;
                }, 2000);
            }
        }

        // Fallback Modal für manuelles Kopieren
        function showCopyModal(text) {
            // Erstelle Modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: #1a1a2e;
                padding: 30px;
                border-radius: 16px;
                max-width: 500px;
                width: 100%;
                color: white;
                border: 1px solid rgba(255,255,255,0.2);
            `;
            
            modalContent.innerHTML = `
                <h3 style="margin: 0 0 15px 0; color: #f5576c;">Text manuell kopieren</h3>
                <p style="margin: 0 0 15px 0; opacity: 0.8;">Bitte kopiere den Text manuell:</p>
                <textarea readonly style="
                    width: 100%;
                    height: 150px;
                    background: rgba(0,0,0,0.3);
                    border: 1px solid rgba(255,255,255,0.2);
                    border-radius: 8px;
                    padding: 12px;
                    color: white;
                    resize: none;
                    font-family: monospace;
                    margin-bottom: 15px;
                ">${text}</textarea>
                <button onclick="this.closest('[modal]').remove()" style="
                    background: linear-gradient(135deg, #f5576c, #f093fb);
                    border: none;
                    padding: 12px 24px;
                    border-radius: 8px;
                    color: white;
                    cursor: pointer;
                    font-weight: 600;
                ">Schließen</button>
            `;
            
            modal.setAttribute('modal', 'true');
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Automatisch Text selektieren
            const textarea = modalContent.querySelector('textarea');
            textarea.focus();
            textarea.select();
            
            // Modal schließen bei Klick außerhalb
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        async function regenerateVariant(textId) {
            if (!currentFormData) {
                alert('Bitte generiere zuerst Texte!');
                return;
            }

            const button = event.target.closest('.favorite-btn');
            const originalHTML = button.innerHTML;
            const card = button.closest('.reel-card');
            
            button.disabled = true;
            button.innerHTML = '<span></span> Generiert...';
            card.style.opacity = '0.7';

            try {
                const response = await fetch('/api/generate-reel', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentFormData)
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.error);

                const newText = data.reelTexts[0];
                const currentIndex = generatedTexts.findIndex(t => t.id === textId);
                
                if (currentIndex !== -1) {
                    generatedTexts[currentIndex] = { ...newText, id: textId };
                    updateSingleCard(card, generatedTexts[currentIndex]);
                }

            } catch (error) {
                alert(`Fehler: ${error.message}`);
            } finally {
                button.disabled = false;
                button.innerHTML = originalHTML;
                card.style.opacity = '1';
            }
        }

        function updateSingleCard(cardElement, newText) {
            cardElement.querySelector('.reel-hook').textContent = newText.hook;
            cardElement.querySelector('.reel-main').textContent = newText.mainText;
            
            cardElement.style.transform = 'scale(1.02)';
            cardElement.style.transition = 'transform 0.3s ease';
            setTimeout(() => cardElement.style.transform = 'scale(1)', 300);
        }
    </script>
</body>
</html>
